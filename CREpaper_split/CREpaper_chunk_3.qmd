Since the equivalece between FE and CRE has been shown for linear models, we focus on the performance of the `cre` in the context of non-linear models. For this we consider 4 different models: probit,  fractional regression probit, tobit,and poisson. 

For each one, the data generating process is as follows:

```
// probit
gen y_probit = 1*(y_star-1+rnormal()>0)
// fractional probit
gen y_fprobit = normal(y_star-1+rnormal())
// tobit
gen y_tobit = max( y_star + rnormal(),0)
// poisson
gen y_poisson = rpoisson(exp(y_star))
```

 We then estimate the models under three assumptions, one where the fixed effects are observed including `c1` and `c2` in the specification (benchmark), one where they are not considered, and one where we use CRE approach using `cre` command. This excercise is repeated 1000 times, and the results are compared in terms of the distributions of the marginal effects for the probit and fractional probit model, and coefficients for the tobit and poisson models, under the three scenarios. We use `parallel`[@vegayon2019] to speed up the process. 

 The results of the simulation are presented in @fig-cre and @tbl-cre. The digure presents the densities of the estimated coefficients across all simulations, whereas the table provides a brief summary of the bias and mean absolute error of the estimated coefficients. 

 :::{#fig-cre fig-pos="H"}

![](simulation/fig1.png)

Estimated marginal effects/Coefficient densities for non-linear 
:::

As expected, controlling for the unobserved effects, the unfeasible estimator, provides what we would consider to be the benchmark/true estimates of coefficients/marginal effects given the sample and data generating process. For @tbl-cre, we use the mean of the uneasible estimator to represent the true point estimate, and construct the bias and mean absolute error for the other estimators.

Because the individual effects are constructed to be correlated with the explanatory variables, the estimated coefficients are bias when they are ignored, and coefficients are estimated using pooled estimators. The magnitud of the bias is approximate 12-13% respect to the point estimate of the coefficient or marginal effect.

On the other hand, the CRE approach seems to provide consistent estimates for the coefficients/marginal effects, with a distribution that is centered around the true point estimate, with slighly higher variance than the benchmark. Based on the results from @tbl-cre, the bias of the CRE approach is negligible, with a MAE that is about 20% to 30% larger than the benchmark.

:::{#tbl-cre tbl-pos="H"} 

 {{< include simulation/table1.txt >}} 

 Bias and MAE for the estimated marginal effects/Coefficients for non-linear models 

 :::


# Conclusion {#sec-5}

This paper introduces the `cre` command, a prefix-type command that facilitates the implementation of Correlated Random Effects (CRE) models with a wide range of official and user-written Stata estimation commands. The CRE approach offers a middle ground between fixed effects and random effects models, addressing some of their limitations, particularly in the context of nonlinear model estimation.

As previously discussed in the literature, our Monte Carlo simulations shows that the CRE approach, implemented through the `cre` command, consistently estimates coefficients and marginal effects, performing comparably to the unfeasible estimators that directly control for unobserved factors. The simulations reveal negligible bias, with an increase in the variance of the estimates, which is consistent with theoretical expectations.

The `cre` command addresses a significant gap in Stata's econometric toolkit, providing a user-friendly implementation of CRE models. This tool may prove valuable for researchers working with panel data or nested data structures, where standard fixed effects approaches may be challenging or nonexistent, and random effects assumptions are not appropriate.